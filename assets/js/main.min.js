module.exports=function(e){function t(){this.last=+new Date,this.delta=function(){var e=(+new Date-this.last)/1e3;return this.last=+new Date,e},this.since=function(e){return+new Date-e},this.now=function(){return+new Date}}var s=e("http://pomegranate-clicker.azurewebsites.net/");s.on("hasPlayer",function(e){e.status?(n.id=l.get("pId"),n.me=e.player,n.updateUI()):(n.preGame.show(),l.remove("pId"),e.err&&a.set(e.title,e.msg))}),s.on("userCreate",function(e){if(e.status){n.id=e.id,n.me=e.player;var t=new Date;t.setTime(t.getTime()+2592e6);var s="expires="+t.toUTCString();document.cookie="pId="+e.id+";"+s+";path=/",n.preGame.hide(),n.updateUI()}else e.err&&n.preGame.msg("bad",e.msg)}),s.on("buyUpgrade",function(e){e.status&&(n.me=e.player,n.updateUI())}),s.on("click",function(e){n.me=e.player,n.updateSeeds()}),s.on("kick",function(e){a.set("You where kicked!",e.msg),s.disconnect()}),s.on("update",function(e){n.me=e.player});var n={id:null,me:{},clicks:0,clock:null,draw:null,time:new t,s:s,dom:{seeds:null,sps:null,pomegranate:null,updrades:{deseeder:{base:null,title:null,lvl:null,sps:null,cost:null,buy:null},backyardShrub:{base:null,title:null,lvl:null,sps:null,cost:null,buy:null},backyardTree:{base:null,title:null,lvl:null,sps:null,cost:null,buy:null}}},preGame:null,updateSeeds:function(){this.dom.seeds.text(Math.floor(this.me.seeds+this.clicks))},updateSPS:function(){this.dom.sps.text(Math.round(this.me.sps))},updateUpgrades:function(){$.each(n.dom.updrades,function(e,t){t.title.text(n.me.upgrades[e].name),t.lvl.text(n.me.upgrades[e].lvl),t.sps.text(Math.round(n.me.upgrades[e].sps)),t.cost.text(Math.ceil(n.me.upgrades[e].cost))})},updateUI:function(){n.updateUpgrades(),n.updateSPS(),n.updateSeeds()},init:function(){var e=l.get("pId");void 0!==e?s.emit("hasPlayer",{id:e}):this.preGame.show(),n.dom.pomegranate.click(function(){n.clicks++,n.updateSeeds()}),$.each(n.dom.updrades,function(e,t){t.buy.click(function(){n.s.emit("buyUpgrade",{name:e})})}),n.clock=setInterval(function(){0!==n.clicks&&(n.s.emit("click",{n:n.clicks}),n.clicks=0),n.updateSeeds()},1e3),n.draw=setInterval(function(){n.me.seeds+=n.me.sps*n.time.delta(),n.updateSeeds()},1e3/30)}};n.preGame={base:null,msgBox:null,input:null,playBtn:null,show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")},msg:function(e,t){this.msgBox.html(t),this.msgBox.removeClass("good bad"),"good"==e?this.msgBox.addClass("good"):this.msgBox.addClass("bad"),this.msgBox.addClass("show")},msgHide:function(){this.msgBox.html(""),this.msgBox.removeClass("show good bad")}};var a={base:null,title:null,msg:null,closeBtn:null,set:function(e,t){this.title.html(e),this.msg.html(t),this.show()},show:function(){this.base.addClass("show")},hide:function(){this.base.removeClass("show")}};window.onload=function(){n.dom.seeds=$("#seedCounter"),n.dom.sps=$("#spsCounter"),$.each(n.dom.updrades,function(e,t){t.base=$("#"+e),t.title=t.base.find(".title"),t.lvl=t.base.find(".lvl"),t.sps=t.base.find(".sps"),t.cost=t.base.find(".cost"),t.buy=t.base.find(".buyBtn")}),n.dom.pomegranate=$("#pomegranate"),n.preGame.base=$(".preGame"),n.preGame.msgBox=$(".preGame > .menuBox > .msgBox"),n.preGame.input=$("#pNameIn"),n.preGame.playBtn=$("#playBtn"),n.preGame.playBtn.click(function(){s.emit("userCreate",{name:n.preGame.input.val()})}),a.base=$(".overlay"),a.title=a.base.find(".title"),a.msg=a.base.find(".msg"),a.closeBtn=a.base.find(".closeBtn"),a.base.click(function(e){e.target==this&&a.hide()}),a.closeBtn.click(function(){a.hide()}),n.init()};var l={get:function(e){var t=document.cookie.replace(/ /g,"").split(";"),s={};for(var n in t){var a=t[n].split("=");s[a[0]]=a[1]}return s[e]},remove:function(e){document.cookie="pId=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;"}}};